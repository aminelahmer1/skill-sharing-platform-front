<!DOCTYPE html>
<div class="notification-dropdown">
  <div class="notification-header">
    <h3>
      <span class="header-icon">üîî</span>
      Notifications
      <span class="badge" *ngIf="unreadNotificationsCount > 0">
        {{ unreadNotificationsCount }}
      </span>
    </h3>
    <button class="mark-all-read" 
            *ngIf="unreadNotificationsCount > 0"
            (click)="markAllAsRead($event)"
            [disabled]="loading">
      <span class="icon">‚úì</span> Tout marquer comme lu
    </button>
  </div>

  <div class="notification-list-container">
    <!-- √âtat de chargement -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <span>Chargement des notifications...</span>
    </div>

    <!-- √âtat d'erreur -->
    <div *ngIf="error && !loading" class="error-state">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadNotifications()">
        üîÑ R√©essayer
      </button>
    </div>

    <!-- Liste des notifications tri√©es par date (plus r√©centes en premier) -->
    <ul class="notification-list" *ngIf="!loading">
      <ng-container *ngFor="let notification of notifications; trackBy: trackById">
        <li class="notification-item"
            [class.unread]="!notification.read"
            [class]="'type-' + getNotificationClass(notification.type)"
            (click)="markAsRead(notification, $event)">
          
          <div class="notification-content">
            <!-- Ic√¥ne de notification -->
            <div class="notification-icon" [class]="getNotificationClass(notification.type)">
              <span>{{ getNotificationIcon(notification.type) }}</span>
            </div>
            
            <!-- D√©tails de la notification -->
            <div class="notification-details">
              <!-- Badge pour les notifications importantes -->
              <div class="notification-header-info">
                <span class="notification-type-badge" 
                      [class]="'badge-' + getNotificationClass(notification.type)"
                      *ngIf="notification.type === 'LIVESTREAM_STARTED' || 
                             notification.type === '1_HOUR_REMINDER'">
                  URGENT
                </span>
              </div>
              
              <!-- Message principal complet (sans troncature) -->
              <p class="notification-message" [title]="notification.message">
                {{ notification.message }}
              </p>
              
              <!-- Timestamp -->
              <div class="notification-footer">
                <small class="notification-time">
                  <span class="time-icon">üïí</span>
                  {{ getTimeAgo(notification.createdAt) }}
                </small>
                
                <!-- Date compl√®te au survol -->
                <small class="notification-date" [title]="notification.createdAt | date:'dd/MM/yyyy HH:mm:ss'">
                  {{ notification.createdAt | date:'dd/MM HH:mm' }}
                </small>
              </div>
            </div>
            
            <!-- Indicateur non lu -->
            <div class="notification-status">
              <div *ngIf="!notification.read" class="unread-indicator"></div>
              <div *ngIf="notification.type === 'LIVESTREAM_STARTED'" class="live-indicator">
                <span class="pulse"></span>
              </div>
            </div>
          </div>
        </li>
      </ng-container>

      <!-- √âtat vide -->
      <li *ngIf="!loading && notifications.length === 0" class="empty-state">
        <div class="empty-icon">üì≠</div>
        <p>Aucune notification</p>
        <small>Vous √™tes √† jour !</small>
      </li>
    </ul>
  </div>

</div>