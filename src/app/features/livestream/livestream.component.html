<div class="livestream-container">
  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-content">
      <mat-spinner diameter="60"></mat-spinner>
      <p class="loading-text">Chargement de la session...</p>
      <div class="loading-details">Connexion au notre serveur </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !isLoading">
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon class="error-icon" color="warn">error_outline</mat-icon>
          <h3 class="error-title">√âchec de la connexion</h3>
          <p class="error-message">{{ error }}</p>
          <div class="error-actions">
            <button mat-raised-button color="primary" (click)="startStreaming()" *ngIf="!isLoading">
              <mat-icon>refresh</mat-icon>
              R√©essayer
            </button>
            <button mat-stroked-button (click)="navigateToSkillsPage()">
              <mat-icon>home</mat-icon>
              Retour
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
 <!-- ===== SECTION MINIATURES EN HAUT UNIFI√âE ===== -->
<section class="top-thumbnails-section" *ngIf="isConnected">
  <div class="thumbnails-header-section">
    <h3 class="thumbnails-title">
      <mat-icon>people</mat-icon>
      Participants
      <span class="participant-count-chip">{{ totalParticipants }}</span>
    </h3>
  </div>
  
  <div class="top-thumbnails-container" 
       #topThumbnailContainer
       role="region"
       aria-label="Miniatures des participants"
       tabindex="0">
    
    <!-- Placeholder si aucun participant -->
    <div class="top-thumbnails-empty" 
         *ngIf="participantInfos.length === 0 && receiverThumbnails.size === 0">
      <mat-icon>person_add</mat-icon>
      <span>En attente des participants...</span>
    </div>
    
    <!-- Section Producer (si receiver regarde) -->
    <div class="producer-thumbnails-group" 
         *ngIf="!isHost && hasProducerThumbnail()"
         id="producer-thumbnail-wrapper">
      <div class="thumbnail-group-label">Producteur</div>
      <!-- Le producer thumbnail sera ajout√© ici dynamiquement -->
    </div>
    
    <!-- Section Receivers -->
    <div class="receivers-thumbnails-group" 
         *ngIf="receiverThumbnails.size > 0"
         id="receivers-thumbnail-wrapper">
      <div class="thumbnail-group-label">Spectateurs</div>
      <!-- Les receiver thumbnails seront ajout√©s ici dynamiquement -->
    </div>
    
    <!-- Les autres miniatures existantes seront aussi ajout√©es dynamiquement -->
  </div>
</section>
  <!-- Main Content -->
  <div class="stream-content" *ngIf="!isLoading && !error">
    <!-- Header Section -->
    <header class="stream-header">
      <div class="stream-info">
        <div class="stream-title-section">
          <h2 class="stream-title">{{ session?.skillName || session?.roomName || 'Diffusion en direct' }}</h2>
          <div class="stream-status-badge" [class.live]="isConnected" [class.offline]="!isConnected">
            <mat-icon>{{ isConnected ? 'radio_button_checked' : 'radio_button_unchecked' }}</mat-icon>
            <span>{{ isConnected ? 'EN DIRECT' : 'HORS LIGNE' }}</span>
          </div>
        </div>
        
        <div class="stream-stats">
          <div class="stat-item" matTooltip="Dur√©e du stream">
            <mat-icon>schedule</mat-icon>
            <span>{{ formattedDuration }}</span>
          </div>
          <div class="stat-item" matTooltip="Total des participants">
            <mat-icon>people</mat-icon>
            <span>{{ totalParticipants }} participant{{ totalParticipants !== 1 ? 's' : '' }}</span>
          </div>
          
          <!-- Recording Status Indicator -->
          <div class="recording-indicator" *ngIf="recordingStatus.isRecording">
            <mat-icon color="warn" class="recording-pulse">fiber_manual_record</mat-icon>
            <span>ENREGISTREMENT {{ formattedRecordingDuration }}</span>
          </div>
        </div>
      </div>

      <!-- Host Controls -->
      <div class="host-controls" *ngIf="isHost && isConnected">
        <!-- Screen Share Control -->
        <button mat-mini-fab 
                [color]="isScreenSharing ? 'accent' : 'primary'"
                (click)="toggleScreenShare()" 
                [disabled]="!isConnected"
                [class.active]="isScreenSharing"
                matTooltip="{{ isScreenSharing ? 'Arr√™ter le partage d\'√©cran' : 'Partager l\'√©cran' }}">
          <mat-icon>{{ isScreenSharing ? 'stop_screen_share' : 'screen_share' }}</mat-icon>
        </button>
        
        <!-- Recording Control -->
        <button mat-mini-fab 
                [color]="recordingStatus.isRecording ? 'warn' : 'primary'" 
                (click)="toggleRecording()"
                [disabled]="!isConnected || isRecordingProcessing"
                matTooltip="{{ recordingStatus.isRecording ? 'Arr√™ter l\'enregistrement' : 'D√©marrer l\'enregistrement' }}">
          <mat-icon *ngIf="!isRecordingProcessing">
            {{ recordingStatus.isRecording ? 'stop' : 'fiber_manual_record' }}
          </mat-icon>
          <mat-spinner *ngIf="isRecordingProcessing" diameter="24"></mat-spinner>
        </button>
        
        <!-- Chat Toggle avec Badge am√©lior√© -->
        <button mat-mini-fab 
                [color]="showChat ? 'accent' : 'primary'"
                (click)="toggleChat()"
                [class.active]="showChat"
                matTooltip="{{ showChat ? 'Masquer le chat' : 'Afficher le chat' }}"
                [matBadge]="unreadChatCount > 0 ? unreadChatCount : null"
                [matBadgeHidden]="showChat || unreadChatCount === 0"
                matBadgeColor="warn"
                matBadgeSize="small">
          <mat-icon>{{ showChat ? 'chat_bubble' : 'chat_bubble_outline' }}</mat-icon>
        </button>
        
        <!-- End Session -->
        <button mat-raised-button color="warn" 
                (click)="endSession()" 
                [disabled]="!isConnected"
                class="end-session-btn">
          <mat-icon>call_end</mat-icon>
          Terminer
        </button>
      </div>

      <!-- Viewer Controls -->
      <div class="viewer-controls" *ngIf="!isHost && isConnected">
        <button mat-mini-fab 
                [color]="showChat ? 'accent' : 'primary'"
                (click)="toggleChat()"
                [class.active]="showChat"
                matTooltip="{{ showChat ? 'Masquer le chat' : 'Afficher le chat' }}"
                [matBadge]="unreadChatCount > 0 ? unreadChatCount : null"
                [matBadgeHidden]="showChat || unreadChatCount === 0"
                matBadgeColor="warn"
                matBadgeSize="small">
          <mat-icon>{{ showChat ? 'chat_bubble' : 'chat_bubble_outline' }}</mat-icon>
        </button>
      </div>
    </header>

  

    <!-- Main Content Layout -->
    <div class="main-layout" 
         [class.with-chat]="showChat"
         [class.with-participants]="!showChat && participantInfos.length > 0">
      
      <!-- Video Section -->
      <section class="video-section" 
               [class.with-chat]="showChat"
               [class.with-participants]="!showChat && participantInfos.length > 0">
        
        <!-- Primary Video Container -->
        <div class="primary-video-container">
          <div class="main-video-wrapper">
            <div class="main-video" #mainVideoContainer>
              
              <!-- Video Placeholder pour non connect√© -->
              <div class="video-placeholder" *ngIf="!isConnected">
                <div class="placeholder-content">
                  <mat-icon class="placeholder-icon">videocam_off</mat-icon>
                  <h3 *ngIf="showStartButton">Pr√™t √† rejoindre</h3>
                  <p *ngIf="showStartButton">Cliquez sur "{{ isHost ? 'D√©marrer le stream' : 'Rejoindre le stream' }}" pour commencer</p>
                  <div *ngIf="!showStartButton && !isConnected" class="connecting-status">
                    <mat-spinner diameter="30"></mat-spinner>
                    <p>Connexion en cours...</p>
                  </div>
                </div>
              </div>

              <!-- Placeholder pour receiver en attente du producteur -->
              <div class="video-placeholder" *ngIf="isConnected && !isHost && currentMainVideoSource === 'none'">
                <div class="placeholder-content">
                  <mat-icon class="placeholder-icon">videocam_off</mat-icon>
                  <h3>En attente du producteur</h3>
                  <p>Le producteur n'a pas encore activ√© sa cam√©ra ou son partage d'√©cran</p>
                  <div class="connecting-status">
                    <mat-spinner diameter="30"></mat-spinner>
                    <p>Synchronisation...</p>
                  </div>
                </div>
              </div>

              <!-- üÜï NOUVEAU: Les miniatures receivers seront cr√©√©es ici dynamiquement 
                   en position fixed bottom-right via TypeScript -->
              
            </div>

            <!-- Video Status Overlay -->
            <div class="video-status-overlay" *ngIf="isConnected">
              <div class="status-badges">
                <!-- Badge pour partage d'√©cran du producteur -->
                <span class="video-badge screen-share" *ngIf="currentMainVideoSource === 'producer-screen'">
                  <mat-icon>screen_share</mat-icon>
                  {{ isHost ? 'Partage d\'√©cran' : 'Partage d\'√©cran du producteur' }}
                </span>
                <!-- Badge pour cam√©ra du producteur -->
                <span class="video-badge main-camera" *ngIf="currentMainVideoSource === 'producer-camera'">
                  <mat-icon>videocam</mat-icon>
                  {{ isHost ? 'Cam√©ra principale' : 'Cam√©ra du producteur' }}
                </span>
                <!-- Badge de qualit√© -->
                <span class="video-badge quality-indicator" *ngIf="hasMainContent">
                  <mat-icon>hd</mat-icon>
                  HD
                </span>
              </div>
            </div>

            <!-- Picture-in-Picture -->
            <div class="pip-container" *ngIf="isConnected && isScreenSharing && isHost">
              <div class="pip-video" #pipVideoContainer></div>
              <div class="pip-label">
                <mat-icon>videocam</mat-icon>
                <span>Votre cam√©ra</span>
              </div>
              <div class="pip-controls">
                <button mat-icon-button 
                        (click)="toggleVideo()"
                        [color]="isVideoOff ? 'warn' : 'primary'"
                        matTooltip="Basculer la cam√©ra">
                  <mat-icon>{{ isVideoOff ? 'videocam_off' : 'videocam' }}</mat-icon>
                </button>
              </div>
            </div>

            <!-- Fullscreen Control -->
            <div class="fullscreen-control" *ngIf="!isHost && isConnected && hasMainContent">
              <button mat-mini-fab color="primary" 
                      (click)="toggleFullscreen()"
                      matTooltip="Basculer en plein √©cran">
                <mat-icon>{{ isFullscreen ? 'fullscreen_exit' : 'fullscreen' }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Participants Sidebar -->
      <aside class="participants-sidebar" *ngIf="isConnected && !showChat && participantInfos.length > 0">
        <mat-card class="participants-card">
          <mat-card-header>
            <mat-card-title class="participants-title">
              <mat-icon>people</mat-icon>
              Participants en ligne
              <mat-chip-set>
                <mat-chip class="participant-count">{{ participantInfos.length }}</mat-chip>
              </mat-chip-set>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="participants-list">
              <div class="participant-item" *ngFor="let info of participantInfos; trackBy: trackParticipant">
                <div class="participant-avatar">
                  <mat-icon [class.producer]="info.isProducer">
                    {{ info.isProducer ? 'star' : 'person' }}
                  </mat-icon>
                </div>
                <div class="participant-info">
                  <span class="participant-name">{{ info.displayName }}</span>
                  <span class="participant-role" [class.host]="info.isProducer">
                    {{ info.isProducer ? 'Producteur' : 'Spectateur' }}
                  </span>
                  <span class="participant-joined">
                    Connect√© {{ info.joinedAt | date:'short' }}
                  </span>
                </div>
                <div class="participant-status">
                  <div class="status-indicator online"></div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </aside>

      <!-- Chat Section -->
      <aside class="chat-section" *ngIf="showChat && isConnected">
        <mat-card class="chat-container">
          <mat-card-header class="chat-header">
            <mat-card-title class="chat-title">
              <div class="chat-title-section">
                <mat-icon>chat</mat-icon>
                <span>Chat en direct</span>
                <span class="participant-count-chip">{{ totalParticipants }}</span>
              </div>
              
              <!-- Indicateur de connexion chat -->
              <div class="chat-connection-status" 
                   [class.connected]="isChatConnected"
                   [class.connecting]="chatConnectionStatus === 'CONNECTING'"
                   [class.reconnecting]="chatConnectionStatus === 'RECONNECTING'"
                   [class.disconnected]="!isChatConnected"
                   role="status"
                   [attr.aria-live]="'polite'"
                   [attr.aria-label]="'Statut du chat: ' + chatConnectionStatusText">

                <mat-icon [class.spin]="chatConnectionStatus === 'CONNECTING' || chatConnectionStatus === 'RECONNECTING'"
                          [attr.aria-hidden]="true">
                  {{ isChatConnected ? 'wifi' : 'wifi_off' }}
                </mat-icon>
                <span class="status-text">{{ chatConnectionStatusText }}</span>
                
                <!-- Message informatif au d√©but -->
                <small class="connection-info" *ngIf="!isConnected && !isChatConnected">
                  Le chat se connectera automatiquement
                </small>
                
                <!-- Bouton de reconnexion si d√©connect√© ET que le stream est d√©marr√© -->
                <button mat-icon-button 
                        *ngIf="!isChatConnected && isConnected && chatConnectionStatus !== 'CONNECTING'"
                        (click)="reconnectChat()"
                        matTooltip="Reconnecter le chat"
                        class="reconnect-btn"
                        [attr.aria-label]="'Reconnecter le chat'">
                  <mat-icon>refresh</mat-icon>
                </button>
              </div>
            </mat-card-title>
          </mat-card-header>

          <mat-card-content class="chat-content">
            <div class="messages-container" #messagesContainer>
              
              <!-- Loading State -->
              <div class="chat-loading-container" *ngIf="isChatLoading"
                   role="status"
                   aria-label="Chargement du chat en cours">
                <mat-spinner diameter="30"></mat-spinner>
                <p>Connexion au chat...</p>
              </div>

              <!-- Messages List -->
              <div class="messages-list" 
                   *ngIf="!isChatLoading"
                   role="log"
                   aria-label="Liste des messages du chat"
                   [attr.aria-live]="'polite'"
                   [attr.aria-relevant]="'additions'">
                <div class="message-wrapper" 
                     *ngFor="let message of chatMessages; trackBy: trackChatMessage"
                     [class.own-message]="isOwnChatMessage(message)"
                     [class.other-message]="!isOwnChatMessage(message)"
                     role="article"
                     [attr.aria-label]="getMessageAriaLabel(message)">
                  <div class="message">
                    <div class="message-header" [attr.aria-hidden]="true">
                      <span class="username" 
                            [class.own-username]="isOwnChatMessage(message)">
                        {{ isOwnChatMessage(message) ? 'Vous' : message.username }}
                      </span>
                      <span class="timestamp">{{ message.timestamp | date:'HH:mm' }}</span>
                    </div>
                    <div class="message-content">{{ message.message }}</div>
                  </div>
                </div>
              </div>

              <!-- Typing Indicators -->
              <div class="typing-indicators" 
                   *ngIf="typingUsersArray.length > 0"
                   role="status"
                   [attr.aria-live]="'polite'"
                   [attr.aria-label]="getTypingIndicatorAriaLabel()">
                <div class="typing-indicator" 
                     *ngFor="let user of typingUsersArray"
                     [attr.aria-hidden]="true">
                  <div class="typing-animation">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                  </div>
                  <span class="typing-text">{{ user.username }} √©crit...</span>
                </div>
              </div>

              <!-- Empty State -->
              <div class="empty-chat" 
                   *ngIf="!isChatLoading && chatMessages.length === 0 && isChatConnected"
                   role="status"
                   aria-label="Aucun message dans le chat">
                <mat-icon class="empty-icon" [attr.aria-hidden]="true">chat_bubble_outline</mat-icon>
                <p class="empty-title">Aucun message pour le moment</p>
                <small class="empty-subtitle">Soyez {{ isHost ? 'le premier' : 'la premi√®re' }} √† √©crire !</small>
              </div>

              <!-- Disconnected State -->
              <div class="chat-disconnected" 
                   *ngIf="!isChatConnected && !isChatLoading"
                   role="alert"
                   aria-label="Chat d√©connect√©">
                <mat-icon class="disconnected-icon" color="warn" [attr.aria-hidden]="true">wifi_off</mat-icon>
                <p class="disconnected-title">Chat d√©connect√©</p>
                <small class="disconnected-subtitle">{{ chatConnectionStatusText }}</small>
                <button mat-raised-button 
                        color="primary" 
                        (click)="reconnectChat()"
                        [disabled]="chatConnectionStatus === 'CONNECTING'"
                        [attr.aria-label]="chatConnectionStatus === 'CONNECTING' ? 'Reconnexion en cours' : 'Reconnecter le chat'">
                  <mat-icon>refresh</mat-icon>
                  {{ chatConnectionStatus === 'CONNECTING' ? 'Connexion...' : 'Reconnecter' }}
                </button>
              </div>
            </div>
          </mat-card-content>

          <!-- Message Form -->
          <mat-card-actions class="chat-actions">
            <form class="message-form" 
                  (ngSubmit)="sendChatMessage()"
                  role="form"
                  aria-label="Formulaire d'envoi de message chat">
              <mat-form-field appearance="outline" class="message-input">
                <mat-label>{{ isChatConnected ? 'Tapez votre message...' : 'Chat d√©connect√©' }}</mat-label>
                <textarea 
                  matInput
                  #messageInput
                  [(ngModel)]="newChatMessage"
                  (input)="onChatMessageInput()"
                  (keypress)="onChatKeyPress($event)"
                  [disabled]="!isChatConnected"
                  name="message"
                  id="chat-message-input"
                  rows="2"
                  maxlength="500"
                  placeholder="{{ isChatConnected ? 'Appuyez sur Entr√©e pour envoyer' : 'Chat d√©connect√©' }}"
                  title="{{ isChatConnected ? 'Zone de saisie pour √©crire un message dans le chat. Appuyez sur Entr√©e pour envoyer.' : 'Chat d√©connect√© - impossible de saisir un message' }}"
                  [class.disabled]="!isChatConnected"
                  [attr.aria-label]="isChatConnected ? 'Zone de saisie de message chat' : 'Chat d√©connect√© - saisie indisponible'"
                  [attr.aria-describedby]="'chat-message-hint'"
                  [attr.aria-required]="isChatConnected"
                  [attr.aria-invalid]="!isChatConnected">
                </textarea>
                
                <mat-hint align="end" 
                         id="chat-message-hint"
                         [class.error-hint]="!isChatConnected"
                         [attr.aria-live]="'polite'">
                  {{ isChatConnected ? newChatMessage.length + '/500' : 'Chat d√©connect√©' }}
                </mat-hint>
                
                <!-- Ic√¥ne d'√©tat dans le champ -->
                <mat-icon matSuffix 
                          [color]="isChatConnected ? 'primary' : 'warn'"
                          [attr.aria-label]="isChatConnected ? 'Chat connect√©' : 'Chat d√©connect√©'"
                          [attr.aria-hidden]="true"
                          matTooltip="{{ isChatConnected ? 'Chat connect√©' : 'Chat d√©connect√©' }}">
                  {{ isChatConnected ? 'send' : 'wifi_off' }}
                </mat-icon>
              </mat-form-field>
              
              <!-- Bouton d'envoi -->
              <button 
                mat-fab 
                color="primary" 
                type="submit"
                [disabled]="!isChatConnected || !newChatMessage.trim()"
                [class.pulse]="isChatConnected && newChatMessage.trim()"
                [attr.aria-label]="getSubmitButtonAriaLabel()"
                [attr.title]="getSubmitButtonTitle()"
                matTooltip="{{ getSubmitButtonTooltip() }}">
                <mat-icon *ngIf="isChatConnected" [attr.aria-hidden]="true">send</mat-icon>
                <mat-icon *ngIf="!isChatConnected" color="warn" [attr.aria-hidden]="true">wifi_off</mat-icon>
              </button>
            </form>
            
            <!-- Status bar du chat -->
            <div class="chat-status-bar" 
                 [class.connected]="isChatConnected"
                 role="status"
                 [attr.aria-live]="'polite'"
                 [attr.aria-label]="'Statut du chat: ' + chatConnectionStatusText">
              <div class="status-indicator-dot" 
                   [class.connected]="isChatConnected"
                   [attr.aria-hidden]="true"></div>
              <span class="status-text">{{ chatConnectionStatusText }}</span>
              <span class="messages-count" 
                    *ngIf="isChatConnected"
                    [attr.aria-label]="'Nombre de messages: ' + chatMessages.length">
                ({{ chatMessages.length }} messages)
              </span>
            </div>
          </mat-card-actions>
        </mat-card>
      </aside>
    </div>

    <!-- Control Panel -->
    <footer class="control-panel">
      <!-- Join Button -->
      <div class="join-section" *ngIf="showStartButton">
        <div class="join-info">
          <h3>Pr√™t √† rejoindre la diffusion en direct</h3>
          <p *ngIf="isHost">Vous animez cette session</p>
          <p *ngIf="!isHost">Vous allez rejoindre en tant que spectateur</p>
        </div>
        <button mat-raised-button 
                color="primary" 
                size="large" 
                class="join-button"
                (click)="startStreaming()"
                [disabled]="isLoading">
          <mat-icon>play_arrow</mat-icon>
          {{ isHost ? 'D√©marrer le stream' : 'Rejoindre le stream' }}
        </button>
      </div>

      <!-- Media Controls -->
      <div class="media-controls" *ngIf="isConnected">
        <div class="control-group">
          <!-- Mute Toggle -->
          <button mat-fab 
                  [color]="isMuted ? 'warn' : 'primary'" 
                  [class.muted]="isMuted"
                  (click)="toggleMute()"
                  matTooltip="{{ isMuted ? 'R√©activer le micro' : 'Couper le micro' }}">
            <mat-icon>{{ isMuted ? 'mic_off' : 'mic' }}</mat-icon>
          </button>
          
          <!-- Video Toggle avec tooltip am√©lior√© -->
          <button mat-fab 
                  [color]="isVideoOff ? 'warn' : 'primary'" 
                  [class.video-off]="isVideoOff"
                  (click)="toggleVideo()"
                  matTooltip="{{ getVideoToggleTooltip() }}">
            <mat-icon>{{ isVideoOff ? 'videocam_off' : 'videocam' }}</mat-icon>
          </button>

         
          
          <!-- Leave Button -->
          <button mat-fab 
                  color="accent" 
                  (click)="navigateToSkillsPage()"
                  matTooltip="Quitter le stream"
                  class="leave-button">
            <mat-icon>exit_to_app</mat-icon>
          </button>
        </div>
        
        <!-- Status indicators -->
        <div class="control-status">
          <div class="connection-quality">
            <mat-icon [style.color]="isConnected ? '#4CAF50' : '#f44336'">
              {{ isConnected ? 'signal_cellular_4_bar' : 'signal_cellular_0_bar' }}
            </mat-icon>
            <span class="quality-text">
              {{ isConnected ? 'Excellente' : 'D√©connect√©' }}
            </span>
          </div>

          <!-- Chat Status -->
          <div class="chat-status" *ngIf="showChat">
            <mat-icon [style.color]="isChatConnected ? '#4CAF50' : '#f44336'">chat</mat-icon>
            <span class="status-text">
              Chat {{ chatConnectionStatusText.toLowerCase() }}
            </span>
            <span class="unread-indicator" *ngIf="unreadChatCount > 0">({{ unreadChatCount }})</span>
          </div>

          <!-- üÜï NOUVEAU: Statut des miniatures receivers -->
          <div class="thumbnails-status" *ngIf="!isHost && receiverThumbnailsCount > 0">
            <mat-icon [style.color]="'#2196F3'">people</mat-icon>
            <span class="status-text">
              {{ receiverThumbnailsCount }} participant{{ receiverThumbnailsCount > 1 ? 's' : '' }}
            </span>
          </div>

          <!-- Recording Status -->
          <div class="recording-status" *ngIf="isHost && recordingStatus.isRecording">
            <mat-icon style="color: #f44336" class="recording-pulse">fiber_manual_record</mat-icon>
            <span class="status-text">{{ formattedRecordingDuration }}</span>
          </div>
        </div>
      </div>
    </footer>

    <!-- Status Indicators -->
    

    <!-- Toast de notification pour le chat -->
    <div class="chat-notifications" 
         *ngIf="unreadChatCount > 0 && !showChat"
         style="position: fixed; top: 140px; right: 20px; z-index: 1000;">
      <mat-card class="notification-card" 
                style="background: #3f51b5; color: white; cursor: pointer;"
                (click)="toggleChat()"
                role="button"
                [attr.aria-label]="'Vous avez ' + unreadChatCount + ' nouveau message dans le chat. Cliquez pour ouvrir.'">
        <mat-card-content style="padding: 12px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <mat-icon [attr.aria-hidden]="true">chat_bubble</mat-icon>
            <span>{{ unreadChatCount }} nouveau{{ unreadChatCount > 1 ? 'x' : '' }} message{{ unreadChatCount > 1 ? 's' : '' }}</span>
            <mat-icon [attr.aria-hidden]="true">keyboard_arrow_down</mat-icon>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Element invisible pour les annonces aux lecteurs d'√©cran -->
    <div id="screen-reader-announcements" 
         class="sr-only" 
         aria-live="polite" 
         aria-atomic="true">
    </div>
  </div>
</div>

<!-- Badge invisible pour les lecteurs d'√©cran -->
<span id="unread-messages-count" 
      class="sr-only" 
      *ngIf="unreadChatCount > 0"
      [attr.aria-live]="'polite'"></span>