<div class="profile-container">
  <!-- État de chargement -->
  <mat-card *ngIf="isLoading" class="loading-card">
    <mat-card-content class="loading-content">
      <mat-spinner diameter="60" color="primary"></mat-spinner>
      <p class="loading-text">Chargement de votre profil...</p>
    </mat-card-content>
  </mat-card>

  <!-- État d'erreur -->
  <mat-card *ngIf="error && !isLoading" class="error-card">
    <mat-card-content class="error-content">
      <mat-icon color="warn" class="error-icon">error_outline</mat-icon>
      <span class="error-text">{{ error }}</span>
    </mat-card-content>
  </mat-card>

  <!-- Profil utilisateur -->
  <mat-card *ngIf="(profile$ | async) as profile" class="profile-card">
    <!-- Header du profil simplifié -->
    <mat-card-header class="profile-header">
      <div mat-card-avatar class="profile-avatar">
        <img 
          [src]="profile.pictureUrl || 'assets/images/default-profile.png'"
          alt="Photo de profil de {{ profile.firstName }} {{ profile.lastName }}"
          class="avatar-image"
          (error)="onImageError($event)"
          loading="lazy"
        >
      </div>
      
      <div class="profile-title">
        <mat-card-title>
          {{ profile.firstName }} {{ profile.lastName }}
        </mat-card-title>
        <mat-card-subtitle>
          <mat-icon class="subtitle-icon">email</mat-icon>
          {{ profile.email }}
        </mat-card-subtitle>
      </div>
    </mat-card-header>

    <!-- Contenu du profil avec layout côte à côte -->
    <mat-card-content class="profile-content">
      <div class="profile-layout">
        
        <!-- Colonne gauche - Informations -->
        <div class="profile-info-column">
          <!-- Informations de base -->
          <div class="details-section">
            <h3 class="details-title">
              <mat-icon>person</mat-icon>
              Informations personnelles
            </h3>
            
            <div class="detail-row" *ngIf="profile.username">
              <mat-icon class="detail-icon">account_circle</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Nom d'utilisateur</span>
                <span class="detail-value">{{ profile.username }}</span>
              </div>
            </div>

            <div class="detail-row" *ngIf="profile.phoneNumber">
              <mat-icon class="detail-icon">phone</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Téléphone</span>
                <span class="detail-value">{{ profile.phoneNumber }}</span>
              </div>
            </div>

            <div class="detail-row" *ngIf="profile.bio">
              <mat-icon class="detail-icon">info</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Biographie</span>
                <span class="detail-value bio-text">{{ profile.bio }}</span>
              </div>
            </div>

            <div class="detail-row">
              <mat-icon class="detail-icon">schedule</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Membre depuis</span>
                <span class="detail-value">
                  {{ profile.createdAt | date:'dd MMMM yyyy':'fr-FR' }}
                  <span class="member-duration">
                    ({{ getMemberDuration(profile.createdAt) }})
                  </span>
                </span>
              </div>
            </div>
          </div>

          <!-- Informations d'adresse -->
          <div class="details-section" *ngIf="profile.address?.city || profile.address?.country">
            <h3 class="details-title">
              <mat-icon>location_on</mat-icon>
              Localisation
            </h3>
            
            <div class="detail-row">
              <mat-icon class="detail-icon">place</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Adresse</span>
                <span class="detail-value">{{ getFormattedAddress(profile) }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Colonne droite - Carte - toujours afficher -->
        <div class="map-column">
          <div class="map-section">
            <div class="map-header">
              <h3 class="map-title">
                <mat-icon class="map-icon">map</mat-icon>
                Localisation géographique
              </h3>
              <div class="map-controls">
                <button 
                  mat-icon-button 
                  class="map-control-btn"
                  matTooltip="Centrer la carte"
                  (click)="centerMap()"
                >
                  <mat-icon>my_location</mat-icon>
                </button>
              </div>
            </div>
            
            <div class="map-container">
              <div #map class="map"></div>
              <div class="map-overlay">
                <div class="location-info">
                  <mat-icon>location_on</mat-icon>
                  <span>{{ getFormattedAddress(profile) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>

    <!-- Actions du profil -->
    <mat-card-actions class="profile-actions">
      <button 
        mat-raised-button
        color="primary"
        routerLink="../profile-edit"
        class="edit-button"
        [attr.aria-label]="'Modifier le profil de ' + profile.firstName + ' ' + profile.lastName"
      >
        <mat-icon>edit</mat-icon>
        Modifier le profil
      </button>
    </mat-card-actions>
  </mat-card>
</div>