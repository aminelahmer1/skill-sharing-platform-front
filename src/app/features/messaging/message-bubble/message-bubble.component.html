<!-- message-bubble.component.html - VERSION √âQUILIBR√âE ET SIMPLIFI√âE -->
<div class="message-bubble-container" [class.own-message]="isOwnMessage">
  <!-- Avatar pour les messages re√ßus uniquement -->
  <div class="message-avatar" *ngIf="!isOwnMessage">
    <img [src]="getMessageAvatar()" 
         [alt]="message.senderName"
         (error)="onAvatarError($event)"
         loading="lazy">
  </div>

  <div class="message-content-wrapper">
    <!-- En-t√™te du message (nom de l'exp√©diteur pour les messages re√ßus) -->
    <div class="message-header" *ngIf="!isOwnMessage && message.senderName">
      <span class="sender-name">{{ message.senderName }}</span>
    </div>

    <!-- Bulle de message principale -->
    <div class="message-bubble" 
         [class.deleted]="message.isDeleted"
         [class.text-message]="message.type === 'TEXT'"
         [class.media-message]="isMediaMessage()"
         [ngClass]="message.type === 'TEXT' ? getMessageClasses() : []"
         (mouseenter)="showOptions = true"
         (mouseleave)="showOptions = false">

    

      <!-- MESSAGE TEXTE SIMPLIFI√â -->
      <div *ngIf="!message.isDeleted && message.type === 'TEXT'" 
           class="text-content"
           [ngClass]="getMessageClasses()">
        <p class="message-text" 
           [ngStyle]="getTextDisplayStyle()">
          {{ message.content }}
        </p>
      </div>

      <!-- MESSAGE IMAGE -->
      <div *ngIf="!message.isDeleted && isImageMessage()" class="image-content">
        <div class="image-wrapper">
          <img [src]="message.attachmentUrl" 
               [alt]="message.content || 'Image'"
               (click)="onImageClick()"
               (error)="onImageError($event)"
               loading="lazy"
               class="message-image">
          <div class="image-overlay" (click)="onImageClick()">
            <span class="zoom-icon">üîç</span>
          </div>
        </div>
        <div class="image-caption" *ngIf="message.content">
          <p>{{ message.content }}</p>
        </div>
      </div>

      <!-- MESSAGE VID√âO -->
      <div *ngIf="!message.isDeleted && isVideoMessage()" class="video-content">
        <div class="video-wrapper">
          <video controls 
                 [src]="message.attachmentUrl"
                 preload="metadata"
                 class="message-video">
            Votre navigateur ne supporte pas la lecture vid√©o.
          </video>
        </div>
        <div class="video-caption" *ngIf="message.content">
          <p>{{ message.content }}</p>
        </div>
      </div>

      <!-- MESSAGE AUDIO -->
      <div *ngIf="!message.isDeleted && isAudioMessage()" class="audio-content">
        <div class="audio-player">
          <button class="audio-play-btn" 
                  (click)="toggleAudioPlay($event)"
                  [class.playing]="isAudioPlaying"
                  [title]="isAudioPlaying ? 'Pause' : 'Lecture'">
            <span *ngIf="!isAudioPlaying">‚ñ∂</span>
            <span *ngIf="isAudioPlaying">‚è∏</span>
          </button>
          
          <div class="audio-info">
            <div class="audio-name">{{ getAudioName() }}</div>
            <div class="audio-duration">{{ getAudioDuration() }}</div>
            
            <div class="audio-progress" (click)="seekAudio($event)">
              <div class="progress-bar" 
                   [style.width.%]="audioProgress">
              </div>
            </div>
          </div>
          
          <audio #audioElement 
                 [src]="message.attachmentUrl" 
                 preload="metadata"
                 (ended)="onAudioEnded()"
                 (timeupdate)="onAudioTimeUpdate($event)"
                 (loadedmetadata)="onAudioLoaded()"
                 style="display: none;">
          </audio>
        </div>
      </div>

      <!-- MESSAGE FICHIER -->
      <div *ngIf="!message.isDeleted && isFileMessage()" class="file-content">
        <a [href]="message.attachmentUrl" 
           target="_blank" 
           class="file-link"
           (click)="onFileClick($event)">
          <div class="file-icon-wrapper">
            <span class="file-icon">{{ getFileIcon() }}</span>
          </div>
          <div class="file-info">
            <div class="file-name">{{ message.content || 'Fichier' }}</div>
            <div class="file-size" *ngIf="getFileSize()">{{ getFileSize() }}</div>
          </div>
          <div class="download-icon">‚¨áÔ∏è</div>
        </a>
      </div>

      <!-- M√âTADONN√âES DU MESSAGE -->
      <div class="message-meta" *ngIf="!message.isDeleted">
        <span class="message-time">{{ formatTime(message.sentAt) }}</span>
        
        <!-- Statut de lecture pour les messages envoy√©s -->
        <div class="message-status" *ngIf="isOwnMessage">
          <span class="status-icon" [ngClass]="getStatusClass()">
            <span *ngIf="message.status === 'SENT'">‚úì</span>
            <span *ngIf="message.status === 'DELIVERED'">‚úì‚úì</span>
            <span *ngIf="message.status === 'READ'">‚úì‚úì</span>
          </span>
        </div>
        
        <!-- Indicateur de modification -->
        <span class="edited-indicator" *ngIf="message.editedAt">
          (modifi√©)
        </span>
      </div>

   
     
    </div>
  </div>
</div>