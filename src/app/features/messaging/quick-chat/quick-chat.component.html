<div class="quick-chat-container">
  <div *ngFor="let window of chatWindows; let i = index" 
       class="chat-window"
       [@slideUp]
       [@minimize]="window.isMinimized ? 'minimized' : 'expanded'"
       [style.right.px]="20 + (i * 340)">
    
    <!-- Header -->
    <div class="chat-header" (click)="toggleMinimize(window)">
      <div class="header-info">
        <img [src]="getConversationAvatar(window.conversation)" 
             [alt]="window.conversation.name"
             class="chat-avatar">
        <div class="chat-title">
          <span class="chat-name">{{ getConversationName(window.conversation) }}</span>
          <span class="chat-status">Actif</span>
        </div>
      </div>
      
      <div class="header-actions">
        <button class="action-btn minimize-btn" (click)="toggleMinimize(window); $event.stopPropagation()">
          <span>{{ window.isMinimized ? '▲' : '▼' }}</span>
        </button>
        <button class="action-btn close-btn" (click)="closeChat(window); $event.stopPropagation()">
          ✕
        </button>
      </div>
    </div>

    <!-- Body (visible seulement si non minimisé) -->
    <div class="chat-body" *ngIf="!window.isMinimized">
      <!-- Messages -->
      <div class="messages-area" #messageContainer>
        <div *ngFor="let message of window.messages" class="quick-message">
          <div class="message-bubble"
               [class.own]="message.senderId === currentUserId"
               [class.other]="message.senderId !== currentUserId">
            <span class="message-text">{{ message.content }}</span>
            <span class="message-time">{{ formatTime(message.sentAt) }}</span>
          </div>
        </div>
      </div>

      <!-- Input -->
      <div class="chat-input">
        <input type="text"
               [(ngModel)]="window.newMessage"
               (input)="onTyping(window)"
               (keypress)="onKeyPress($event, window)"
               placeholder="Aa"
               class="message-input">
        <button class="send-btn" (click)="sendMessage(window)" [disabled]="!window.newMessage.trim()">
          ➤
        </button>
      </div>
    </div>
  </div>
</div>