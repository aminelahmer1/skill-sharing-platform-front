<mat-card class="chat-container">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>chat</mat-icon>
      Chat en direct
    </mat-card-title>
    <div class="connection-status" [class.connected]="isConnected">
      <mat-icon>{{ isConnected ? 'wifi' : 'wifi_off' }}</mat-icon>
      <span>{{ isConnected ? 'Connecté' : 'Déconnecté' }}</span>
    </div>
  </mat-card-header>

  <mat-card-content>
    <div class="messages-container" #messagesContainer>
      <div class="loading-container" *ngIf="isLoading">
        <mat-spinner diameter="30"></mat-spinner>
        <p>Chargement des messages...</p>
      </div>

      <div class="messages-list" *ngIf="!isLoading">
        <div class="message-wrapper" 
             *ngFor="let message of messages; trackBy: trackMessage"
             [class.own-message]="isOwnMessage(message)">
          <div class="message">
            <div class="message-header">
              <span class="username">{{ message.username }}</span>
              <span class="timestamp">{{ message.timestamp | date:'HH:mm' }}</span>
            </div>
            <div class="message-content">{{ message.message }}</div>
          </div>
        </div>
      </div>

      <div class="typing-indicators" *ngIf="typingUsersArray.length > 0">
        <div class="typing-indicator" *ngFor="let user of typingUsersArray">
          <mat-icon class="typing-dots">more_horiz</mat-icon>
          <span>{{ user.username }} est en train d'écrire...</span>
        </div>
      </div>
    </div>
  </mat-card-content>

  <mat-card-actions>
    <form class="message-form" (ngSubmit)="sendMessage()">
      <mat-form-field appearance="outline" class="message-input">
        <mat-label>Tapez votre message...</mat-label>
        <textarea 
          matInput
          #messageInput
          [(ngModel)]="newMessage"
          (input)="onMessageInput()"
          (keypress)="onKeyPress($event)"
          [disabled]="!isConnected"
          name="message"
          rows="2"
          maxlength="500"
          placeholder="Appuyez sur Entrée pour envoyer">
        </textarea>
        <mat-hint align="end">{{ newMessage.length }}/500</mat-hint>
      </mat-form-field>
      
      <button 
        mat-fab 
        color="primary" 
        type="submit"
        [disabled]="!isConnected || !newMessage.trim()"
        matTooltip="Envoyer">
        <mat-icon>send</mat-icon>
      </button>
    </form>
  </mat-card-actions>
</mat-card>